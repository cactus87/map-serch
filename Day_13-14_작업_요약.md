# Day 13-14 ì‘ì—… ìš”ì•½ (WebView JS Interop)

**ë‚ ì§œ**: 2025-12-10  
**ì‘ì—… ì‹œê°„**: 0.5ì‹œê°„  
**ìƒíƒœ**: âœ… ì™„ë£Œ (ì½”ë“œ ê²€ì¦ ì™„ë£Œ, ì‹¤í–‰ í…ŒìŠ¤íŠ¸ ëŒ€ê¸°)

---

## ğŸ“Š ì‘ì—… ê°œìš”

Day 13-14ì˜ ëª©í‘œëŠ” **WebViewì—ì„œ ë„¤ì´ë²„ ì§€ë„ë¥¼ í‘œì‹œí•˜ê³ , ë§ˆì»¤ë¥¼ ë Œë”ë§í•˜ë©°, ë°˜ê²½ í•„í„°ë§ì„ ì—°ë™**í•˜ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.

**ê²°ê³¼**: ëª¨ë“  ì½”ë“œê°€ **ì´ë¯¸ ì™„ì„±**ë˜ì–´ ìˆì—ˆìœ¼ë©°, ë¹Œë“œ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í–ˆìŠµë‹ˆë‹¤! ğŸ‰

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. MainPage.xaml.cs - JS Interop ë©”ì„œë“œ (ì´ë¯¸ ì™„ì„±ë¨)

#### OnWebViewNavigated (ìë™ ë§ˆì»¤ ë Œë”ë§)

```csharp
private async void OnWebViewNavigated(object? sender, WebNavigatedEventArgs e)
{
    if (e.Result != WebNavigationResult.Success) return;

    _isMapReady = true;
    _mapService.SetWebView(MapWebView);
    
    await Task.Delay(500);  // DOM ready ëŒ€ê¸°
    await _mapService.InitMapAsync();  // ì§€ë„ ì´ˆê¸°í™”

    // ëª¨ë“  ë§ˆì»¤ ì¶”ê°€ (ì´ìš©ì 10ëª… + ì§€ì›ì‚¬ 20ëª…)
    var allPersons = _viewModel.Users.Concat(_viewModel.Assistants).ToList();
    await _mapService.AddMarkersAsync(allPersons);  // â­ 30ê°œ ë§ˆì»¤ ìë™ ë Œë”ë§
}
```

**í•µì‹¬**: WebView ë¡œë“œ ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ ì§€ë„ ì´ˆê¸°í™” & ë§ˆì»¤ ë Œë”ë§

---

#### PropertyChanged êµ¬ë… (3ê°€ì§€ ì´ë²¤íŠ¸ ì²˜ë¦¬)

```csharp
private async void OnViewModelPropertyChanged(object? sender, PropertyChangedEventArgs e)
{
    switch (e.PropertyName)
    {
        case nameof(MapViewModel.SelectedUser):
            await HandleSelectedUserChanged();  // ì´ìš©ì ì„ íƒ â†’ ì› ê·¸ë¦¬ê¸°
            break;

        case nameof(MapViewModel.CurrentRadius):
            await HandleRadiusChanged();  // ë°˜ê²½ ë³€ê²½ â†’ ì› ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            break;

        case nameof(MapViewModel.FilteredAssistants):
            await HandleFilteredAssistantsChanged();  // í•„í„°ë§ â†’ ë§ˆì»¤ visibility
            break;
    }
}
```

**í•µì‹¬**: ViewModel ìƒíƒœ ë³€í™”ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì§€ë„ì— ë°˜ì˜

---

#### HandleSelectedUserChanged (ì´ìš©ì ì„ íƒ ì‹œ)

```csharp
private async Task HandleSelectedUserChanged()
{
    if (_viewModel.SelectedUser == null)
    {
        await _mapService.ClearCircleAsync();  // ì„ íƒ í•´ì œ â†’ ì› ì œê±°
        await _mapService.ShowAllMarkersAsync();  // ëª¨ë“  ë§ˆì»¤ í‘œì‹œ
    }
    else
    {
        var user = _viewModel.SelectedUser;
        await _mapService.DrawCircleAsync(user.Latitude, user.Longitude, _viewModel.CurrentRadius);
        await _mapService.SetMapCenterAsync(user.Latitude, user.Longitude);  // ì§€ë„ ì¤‘ì‹¬ ì´ë™
    }
}
```

**í•µì‹¬**: ì´ìš©ì ì„ íƒ â†’ ì§€ë„ì— ë°˜ê²½ ì› ê·¸ë¦¬ê¸° + ì¤‘ì‹¬ ì´ë™

---

#### HandleRadiusChanged (ë°˜ê²½ ë³€ê²½ ì‹œ)

```csharp
private async Task HandleRadiusChanged()
{
    if (_viewModel.SelectedUser != null)
    {
        var user = _viewModel.SelectedUser;
        await _mapService.DrawCircleAsync(user.Latitude, user.Longitude, _viewModel.CurrentRadius);
    }
}
```

**í•µì‹¬**: 1km/3km/ì „ì²´ ë²„íŠ¼ í´ë¦­ â†’ ì› í¬ê¸° ë³€ê²½

---

#### HandleFilteredAssistantsChanged (í•„í„°ë§ ê²°ê³¼ ë°˜ì˜)

```csharp
private async Task HandleFilteredAssistantsChanged()
{
    var filteredIds = _viewModel.FilteredAssistants.Select(a => a.Id).ToHashSet();

    foreach (var assistant in _viewModel.Assistants)
    {
        var isVisible = filteredIds.Contains(assistant.Id);
        await _mapService.SetMarkerVisibleAsync(assistant.Id, isVisible);  // ë°˜ê²½ ì™¸ ë§ˆì»¤ ìˆ¨ê¹€
    }

    foreach (var user in _viewModel.Users)
    {
        await _mapService.SetMarkerVisibleAsync(user.Id, true);  // ì´ìš©ì ë§ˆì»¤ëŠ” í•­ìƒ í‘œì‹œ
    }
}
```

**í•µì‹¬**: ë°˜ê²½ í•„í„°ë§ ê²°ê³¼ì— ë”°ë¼ ì§€ë„ ë§ˆì»¤ í‘œì‹œ/ìˆ¨ê¹€

---

### 2. MapService.cs - ëª¨ë“  JS Interop ë©”ì„œë“œ (ì´ë¯¸ ì™„ì„±ë¨)

#### êµ¬í˜„ëœ ë©”ì„œë“œ (9ê°œ)

| ë©”ì„œë“œ | ê¸°ëŠ¥ | JavaScript í•¨ìˆ˜ |
|--------|------|----------------|
| `InitMapAsync` | ì§€ë„ ì´ˆê¸°í™” | `window.initMap()` |
| `AddMarkerAsync` | ë‹¨ì¼ ë§ˆì»¤ ì¶”ê°€ | `window.addMarker()` |
| `AddMarkersAsync` | ë‹¤ì¤‘ ë§ˆì»¤ ì¶”ê°€ | ë£¨í”„ë¡œ `addMarker` í˜¸ì¶œ |
| `DrawCircleAsync` | ë°˜ê²½ ì› ê·¸ë¦¬ê¸° | `window.drawCircle()` |
| `ClearCircleAsync` | ì› ì œê±° | `window.clearCircle()` |
| `SetMarkerVisibleAsync` | ë§ˆì»¤ í‘œì‹œ/ìˆ¨ê¹€ | `window.setMarkerVisible()` |
| `ShowAllMarkersAsync` | ëª¨ë“  ë§ˆì»¤ í‘œì‹œ | `window.showAllMarkers()` |
| `ClearAllMarkersAsync` | ëª¨ë“  ë§ˆì»¤ ì œê±° | `window.clearAllMarkers()` |
| `SetMapCenterAsync` | ì§€ë„ ì¤‘ì‹¬ ì´ë™ | `window.setMapCenter()` |

**ì½”ë“œ ì˜ˆì‹œ** (AddMarkersAsync):

```csharp
public async Task AddMarkersAsync(IEnumerable<Person> persons)
{
    ThrowIfWebViewNotSet();
    ThrowIfMapNotInitialized();

    foreach (var person in persons)
    {
        await AddMarkerAsync(person);  // â­ 30ê°œ ë§ˆì»¤ ìˆœì°¨ ì¶”ê°€
    }
}
```

---

### 3. map.html - JavaScript í•¨ìˆ˜ (ì´ë¯¸ ì™„ì„±ë¨)

#### í•µì‹¬ í•¨ìˆ˜ë“¤

```javascript
// ì§€ë„ ì´ˆê¸°í™”
function initMap(lat, lng, zoom) {
    map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(lat, lng),
        zoom: zoom
    });
    return true;
}

// ë§ˆì»¤ ì¶”ê°€ (íŒŒë€ ì› vs ì£¼í™© ì‚¬ê°í˜•)
function addMarker(person) {
    const position = new naver.maps.LatLng(person.lat, person.lng);
    const marker = new naver.maps.Marker({
        position: position,
        map: map,
        icon: {
            content: person.type === 'user' 
                ? '<div style="width:12px; height:12px; background:#3B82F6; border-radius:50%;"></div>'
                : '<div style="width:12px; height:12px; background:#F97316;"></div>',
            anchor: new naver.maps.Point(6, 6)
        }
    });
    markers[person.id] = marker;
}

// ë°˜ê²½ ì› ê·¸ë¦¬ê¸° (íŒŒë€ìƒ‰ ë°˜íˆ¬ëª…)
function drawCircle(lat, lng, radiusKm) {
    if (currentCircle) currentCircle.setMap(null);
    
    currentCircle = new naver.maps.Circle({
        map: map,
        center: new naver.maps.LatLng(lat, lng),
        radius: radiusKm * 1000,
        fillColor: '#3B82F6',
        fillOpacity: 0.2,
        strokeColor: '#3B82F6',
        strokeOpacity: 0.8
    });
}

// ë§ˆì»¤ visibility í† ê¸€
function setMarkerVisible(markerId, visible) {
    const marker = markers[markerId];
    if (marker) {
        marker.setMap(visible ? map : null);
    }
}
```

---

## ğŸ¯ í†µí•© íë¦„ (ì „ì²´ ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤)

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì•± ì‹œì‘ â†’ ë§ˆì»¤ ìë™ ë Œë”ë§

```
1. MainPage ë¡œë“œ
   â†“
2. WebView.Navigated ì´ë²¤íŠ¸ ë°œìƒ
   â†“
3. OnWebViewNavigated() ì‹¤í–‰
   â†“
4. MapService.InitMapAsync() â†’ ì§€ë„ ì´ˆê¸°í™”
   â†“
5. MapService.AddMarkersAsync(30ëª…) â†’ ë§ˆì»¤ ë Œë”ë§
   â†“
6. ì§€ë„ì— íŒŒë€ ì› 10ê°œ + ì£¼í™© ì‚¬ê°í˜• 20ê°œ í‘œì‹œ âœ…
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì´ìš©ì ë§ˆì»¤ í´ë¦­ â†’ ë°˜ê²½ ì› ê·¸ë¦¬ê¸°

```
1. CollectionViewì—ì„œ ì´ìš©ì "ê¹€ì˜í¬" ì„ íƒ
   â†“
2. MapViewModel.SelectedUser = ê¹€ì˜í¬
   â†“
3. PropertyChanged ì´ë²¤íŠ¸ ë°œìƒ
   â†“
4. HandleSelectedUserChanged() ì‹¤í–‰
   â†“
5. MapService.DrawCircleAsync(37.6688, 127.0471, 3.0) â†’ 3km ì› ê·¸ë¦¬ê¸°
   â†“
6. MapService.SetMapCenterAsync() â†’ ì§€ë„ ì¤‘ì‹¬ ì´ë™
   â†“
7. ì§€ë„ì— íŒŒë€ ë°˜íˆ¬ëª… ì› í‘œì‹œ âœ…
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë°˜ê²½ ë²„íŠ¼ í´ë¦­ â†’ í•„í„°ë§

```
1. "1km" ë²„íŠ¼ í´ë¦­
   â†“
2. MapViewModel.ChangeRadiusCommand ì‹¤í–‰
   â†“
3. MapViewModel.CurrentRadius = 1.0
   â†“
4. MapViewModel.FilterAssistantsByRadius() â†’ ê±°ë¦¬ ê³„ì‚°
   â†“
5. MapViewModel.FilteredAssistants ì—…ë°ì´íŠ¸ (ë°˜ê²½ ë‚´ ì§€ì›ì‚¬ë§Œ)
   â†“
6. PropertyChanged ì´ë²¤íŠ¸ 2ê°œ ë°œìƒ:
   - CurrentRadius â†’ HandleRadiusChanged() â†’ ì› í¬ê¸° ë³€ê²½
   - FilteredAssistants â†’ HandleFilteredAssistantsChanged() â†’ ë§ˆì»¤ visibility
   â†“
7. ë°˜ê²½ ì™¸ ë§ˆì»¤ ìˆ¨ê¹€, ì¢Œì¸¡ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ âœ…
```

---

## âœ… ë¹Œë“œ í…ŒìŠ¤íŠ¸ ê²°ê³¼

```bash
dotnet build
```

**ê²°ê³¼**:
```
ë¹Œë“œí–ˆìŠµë‹ˆë‹¤.
    ê²½ê³  0ê°œ
    ì˜¤ë¥˜ 0ê°œ

ê²½ê³¼ ì‹œê°„: 00:00:04.72
```

âœ… **ë¹Œë“œ ì„±ê³µ** (4.72ì´ˆ)

---

## ğŸš¨ ë‹¤ìŒ ë‹¨ê³„ (ì‹¤í–‰ í…ŒìŠ¤íŠ¸)

### í•„ìˆ˜ í…ŒìŠ¤íŠ¸ í•­ëª©

| ë²ˆí˜¸ | í…ŒìŠ¤íŠ¸ í•­ëª© | ì˜ˆìƒ ê²°ê³¼ | ìƒíƒœ |
|------|------------|----------|------|
| 1 | ì•± ì‹œì‘ ì‹œ ì§€ë„ ë¡œë“œ | ë„ë´‰êµ¬ì²­ ì¤‘ì‹¬ ì§€ë„ í‘œì‹œ | ğŸŸ¡ ëŒ€ê¸° |
| 2 | ë§ˆì»¤ 30ê°œ ë Œë”ë§ | íŒŒë€ ì› 10ê°œ + ì£¼í™© ì‚¬ê°í˜• 20ê°œ | ğŸŸ¡ ëŒ€ê¸° |
| 3 | ì´ìš©ì ì„ íƒ â†’ ì› ê·¸ë¦¬ê¸° | 3km íŒŒë€ ë°˜íˆ¬ëª… ì› í‘œì‹œ | ğŸŸ¡ ëŒ€ê¸° |
| 4 | 1km ë²„íŠ¼ í´ë¦­ | ì› í¬ê¸° ë³€ê²½, ë§ˆì»¤ í•„í„°ë§ | ğŸŸ¡ ëŒ€ê¸° |
| 5 | ì „ì²´ ë²„íŠ¼ í´ë¦­ | ì› ì œê±°, ëª¨ë“  ë§ˆì»¤ í‘œì‹œ | ğŸŸ¡ ëŒ€ê¸° |

---

## ğŸ“‹ ì™„ë£Œ ì¡°ê±´ ì²´í¬

- [x] âœ… MainPage.xaml.csì— JS Interop ë©”ì„œë“œ ì¶”ê°€
- [x] âœ… WebView Navigated ì´ë²¤íŠ¸ì—ì„œ ë§ˆì»¤ ë Œë”ë§
- [x] âœ… ViewModel PropertyChanged êµ¬ë…
- [x] âœ… SelectedUser ë³€ê²½ â†’ ì› ê·¸ë¦¬ê¸°
- [x] âœ… CurrentRadius ë³€ê²½ â†’ ì› í¬ê¸° ë³€ê²½
- [x] âœ… FilteredAssistants ë³€ê²½ â†’ ë§ˆì»¤ visibility
- [x] âœ… ë¹Œë“œ ì„±ê³µ (ê²½ê³  0ê°œ, ì˜¤ë¥˜ 0ê°œ)
- [ ] ğŸŸ¡ ì‹¤í–‰ í…ŒìŠ¤íŠ¸ (dotnet run)
- [ ] ğŸŸ¡ ì„±ëŠ¥ ì¸¡ì • (ì§€ë„ ë¡œë“œ <3ì´ˆ, ë°˜ê²½ í•„í„° <500ms)

---

## ğŸ‰ Week 2 ì™„ë£Œ!

**ë‹¬ì„± ë‚´ìš©**:
- âœ… Day 8-10: MainPage XAML ë ˆì´ì•„ì›ƒ
- âœ… Day 11-12: ë„¤ì´ë²„ ì§€ë„ HTML + JS Interop
- âœ… Day 13-14: ë§ˆì»¤ ë Œë”ë§ & í•„í„°ë§ ì—°ë™

**ë‹¤ìŒ ì‘ì—…**: Week 3 - Supabase ì—°ë™ (Day 15-21)

---

**ì‘ì„±ì¼**: 2025-12-10  
**ì‘ì„±ì**: AI Assistant  
**ë¬¸ì„œ ë²„ì „**: 1.0
