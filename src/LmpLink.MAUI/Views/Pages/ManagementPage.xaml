<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LmpLink.MAUI.ViewModels"
             xmlns:models="clr-namespace:LmpLink.MAUI.Models"
             x:Class="LmpLink.MAUI.Views.Pages.ManagementPage"
             x:DataType="vm:ManagementViewModel"
             Title="ê´€ë¦¬"
             BackgroundColor="{StaticResource BackgroundDeepNavy}">

    <Grid RowDefinitions="Auto,Auto,*" Padding="20">
        
        <!-- Header -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,15">
            <Label 
                Grid.Column="0"
                Text="ì´ìš©ìž/í™œë™ì§€ì›ì‚¬ ê´€ë¦¬"
                Style="{StaticResource Heading1}"
                TextColor="{StaticResource PrimaryCTA}"
                VerticalOptions="Center" />
            
            <Button 
                Grid.Column="1"
                Text="+ ì‹ ê·œ ë“±ë¡"
                Command="{Binding CreatePersonCommand}"
                BackgroundColor="{StaticResource PrimaryCTA}"
                TextColor="{StaticResource TextWhite}"
                Padding="20,10"
                CornerRadius="8" />
        </Grid>

        <!-- Filter Bar -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="10" Margin="0,0,0,15">
            
            <!-- Type Filter: All -->
            <Button 
                Grid.Column="0"
                Text="ì „ì²´"
                BackgroundColor="{StaticResource SurfaceDarkGray}"
                TextColor="{StaticResource TextWhite}"
                Padding="15,10"
                CornerRadius="8">
                <Button.Triggers>
                    <DataTrigger TargetType="Button" Binding="{Binding SelectedTypeFilter}" Value="all">
                        <Setter Property="BackgroundColor" Value="{StaticResource PrimaryCTA}" />
                    </DataTrigger>
                </Button.Triggers>
            </Button>

            <!-- Type Filter: User -->
            <Button 
                Grid.Column="1"
                Text="ì´ìš©ìž"
                BackgroundColor="{StaticResource SurfaceDarkGray}"
                TextColor="{StaticResource TextWhite}"
                Padding="15,10"
                CornerRadius="8">
                <Button.Triggers>
                    <DataTrigger TargetType="Button" Binding="{Binding SelectedTypeFilter}" Value="user">
                        <Setter Property="BackgroundColor" Value="{StaticResource MarkerUser}" />
                    </DataTrigger>
                </Button.Triggers>
            </Button>

            <!-- Search Bar -->
            <SearchBar 
                Grid.Column="2"
                Placeholder="ì´ë¦„ ë˜ëŠ” ì£¼ì†Œë¡œ ê²€ìƒ‰..."
                Text="{Binding SearchText}"
                BackgroundColor="{StaticResource SurfaceDarkGray}"
                TextColor="{StaticResource TextWhite}"
                PlaceholderColor="{StaticResource TextLightGray}"
                SearchCommand="{Binding ApplyFilterCommand}" />

            <!-- Reload Button -->
            <Button 
                Grid.Column="3"
                Text="ðŸ”„"
                Command="{Binding LoadDataCommand}"
                BackgroundColor="{StaticResource AccentSecondary}"
                TextColor="{StaticResource TextWhite}"
                Padding="15,10"
                CornerRadius="8"
                WidthRequest="50" />
        </Grid>

        <!-- Content: DataGrid -->
        <Grid Grid.Row="2" BackgroundColor="{StaticResource SurfaceDarkGray}" Padding="15" RowDefinitions="Auto,*,Auto">
            
            <!-- Column Headers -->
            <Grid Grid.Row="0" ColumnDefinitions="50,*,100,150,120,80,100" Padding="10" BackgroundColor="{StaticResource SurfaceDarkNavy}">
                <Label Grid.Column="0" Text="ID" Style="{StaticResource Caption}" FontAttributes="Bold" TextColor="{StaticResource PrimaryCTA}" />
                <Label Grid.Column="1" Text="ì´ë¦„" Style="{StaticResource Caption}" FontAttributes="Bold" TextColor="{StaticResource PrimaryCTA}" />
                <Label Grid.Column="2" Text="ìœ í˜•" Style="{StaticResource Caption}" FontAttributes="Bold" TextColor="{StaticResource PrimaryCTA}" />
                <Label Grid.Column="3" Text="ì£¼ì†Œ" Style="{StaticResource Caption}" FontAttributes="Bold" TextColor="{StaticResource PrimaryCTA}" />
                <Label Grid.Column="4" Text="ì „í™”ë²ˆí˜¸" Style="{StaticResource Caption}" FontAttributes="Bold" TextColor="{StaticResource PrimaryCTA}" />
                <Label Grid.Column="5" Text="ê²½ë ¥" Style="{StaticResource Caption}" FontAttributes="Bold" TextColor="{StaticResource PrimaryCTA}" />
                <Label Grid.Column="6" Text="ì•¡ì…˜" Style="{StaticResource Caption}" FontAttributes="Bold" TextColor="{StaticResource PrimaryCTA}" HorizontalTextAlignment="Center" />
            </Grid>

            <!-- Data Rows -->
            <CollectionView Grid.Row="1" ItemsSource="{Binding FilteredPersons}" Margin="0,10,0,0">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Person">
                        <Frame Padding="10" Margin="0,2" CornerRadius="4" BorderColor="{StaticResource TextTertiary}" BackgroundColor="{StaticResource BackgroundDeepNavy}">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ManagementViewModel}}, Path=SelectPersonCommand}" CommandParameter="{Binding}" />
                            </Frame.GestureRecognizers>
                            <Grid ColumnDefinitions="50,*,100,150,120,80,100">
                                <Label Grid.Column="0" Text="{Binding Id}" Style="{StaticResource Body2}" TextColor="{StaticResource TextLightGray}" />
                                <Label Grid.Column="1" Text="{Binding Name}" Style="{StaticResource Body1}" TextColor="{StaticResource TextWhite}" FontAttributes="Bold" />
                                <Label Grid.Column="2" Text="{Binding Type, Converter={StaticResource PersonTypeToKoreanConverter}}" Style="{StaticResource Body2}" TextColor="{StaticResource PrimaryCTA}" />
                                <Label Grid.Column="3" Text="{Binding Address}" Style="{StaticResource Caption}" TextColor="{StaticResource TextLightGray}" LineBreakMode="TailTruncation" />
                                <Label Grid.Column="4" Text="{Binding Phone}" Style="{StaticResource Caption}" TextColor="{StaticResource TextLightGray}" />
                                <Label Grid.Column="5" Text="{Binding ExperienceYears, StringFormat='{0}ë…„'}" Style="{StaticResource Caption}" TextColor="{StaticResource TextLightGray}" IsVisible="{Binding ExperienceYears, Converter={StaticResource IsNotNullConverter}}" />
                                
                                <HorizontalStackLayout Grid.Column="6" Spacing="5" HorizontalOptions="Center">
                                    <Button 
                                        Text="íŽ¸ì§‘"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ManagementViewModel}}, Path=EditPersonCommand}"
                                        BackgroundColor="{StaticResource AccentSecondary}"
                                        TextColor="{StaticResource TextWhite}"
                                        Padding="8,4"
                                        CornerRadius="4"
                                        FontSize="12" />
                                    <Button 
                                        Text="ì‚­ì œ"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ManagementViewModel}}, Path=DeletePersonCommand}"
                                        BackgroundColor="#DC2626"
                                        TextColor="{StaticResource TextWhite}"
                                        Padding="8,4"
                                        CornerRadius="4"
                                        FontSize="12" />
                                </HorizontalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <Label 
                        Text="ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. 'ðŸ”„' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì„¸ìš”."
                        Style="{StaticResource Body1}"
                        TextColor="{StaticResource TextLightGray}"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        Margin="20" />
                </CollectionView.EmptyView>
            </CollectionView>

            <!-- Footer -->
            <Grid Grid.Row="2" ColumnDefinitions="*,Auto" Margin="0,10,0,0">
                <Label 
                    Grid.Column="0"
                    Text="{Binding FilteredPersons.Count, StringFormat='ì´ {0}ëª…'}"
                    Style="{StaticResource Body2}"
                    TextColor="{StaticResource TextLightGray}"
                    VerticalOptions="Center" />
                
                <HorizontalStackLayout Grid.Column="1" Spacing="10">
                    <Label Text="&lt; ì´ì „" Style="{StaticResource Body2}" TextColor="{StaticResource TextLightGray}" VerticalOptions="Center" />
                    <Label Text="íŽ˜ì´ì§€ 1/1" Style="{StaticResource Body2}" TextColor="{StaticResource PrimaryCTA}" VerticalOptions="Center" />
                    <Label Text="ë‹¤ìŒ &gt;" Style="{StaticResource Body2}" TextColor="{StaticResource TextLightGray}" VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Grid>

        </Grid>

    </Grid>

</ContentPage>


