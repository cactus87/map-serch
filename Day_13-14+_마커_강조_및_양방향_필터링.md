# Day 13-14+ 추가 기능: 마커 강조 & 양방향 필터링

**날짜**: 2025-12-10  
**작업 시간**: 1시간  
**상태**: ✅ 완료 (앱 재시작 필요)

---

## 🎯 추가된 기능

### 1. **중심 모드 토글** (이용자 중심 / 활동지원사 중심)
- 위치: 반경 필터 버튼 위
- 선택된 버튼: 파란색 (#3B82F6)
- 비선택 버튼: 회색 (#6B7280)

### 2. **마커 강조 애니메이션** ⭐⭐⭐
클릭한 대상은 **무조건** 다음과 같이 강조 표시:
- ✅ **크기 확대**: 16px → 32px (2배)
- ✅ **색상 변경**: 더 밝게 (#60A5FA, #FB923C)
- ✅ **진동 애니메이션**: Bounce (translateY -10px)
- ✅ **발광 효과**: box-shadow (rgba glow)
- ✅ **이전 마커 복원**: 새 마커 선택 시 이전 마커는 원래 크기로

### 3. **지도 우하단 정보 오버레이**
- **투명도**: #40000000 (75% 투명) ← 이전 #CC000000보다 훨씬 투명
- **모드 표시**: 한글 ("이용자 중심" / "활동지원사 중심")
- **실시간 반영**: 반경 내 인원 수 자동 업데이트
- 색상:
  - 이용자: #60A5FA (파란색)
  - 지원사: #FB923C (주황색)

### 4. **양방향 필터링**
- **이용자 중심** → 활동지원사 필터링
- **활동지원사 중심** → 이용자 필터링

---

## 🔧 핵심 코드

### 1. JavaScript - 마커 강조 (map.html)

```javascript
let highlightedMarker = null; // 현재 강조된 마커 추적

function focusMarker(markerId) {
    const marker = markers[markerId];
    
    // 1. 이전 마커 복원
    if (highlightedMarker && highlightedMarker !== marker) {
        const prevIsUser = highlightedMarker._personType === 'user';
        highlightedMarker.setIcon({
            content: prevIsUser 
                ? '<div style="width:16px;height:16px;..."></div>' // 원래 크기
                : '<div style="width:16px;height:16px;..."></div>',
            anchor: new naver.maps.Point(8, 8)
        });
    }
    
    // 2. 현재 마커 강조 (크기 2배 + 색상 + 애니메이션)
    const isUser = marker._personType === 'user';
    marker.setIcon({
        content: isUser 
            ? `<div style="width:32px;height:32px;...;animation:bounce 0.6s;"></div>`
            : `<div style="width:32px;height:32px;...;animation:bounce 0.6s;"></div>`,
        anchor: new naver.maps.Point(16, 16) // 중심점도 2배
    });
    
    highlightedMarker = marker;
    
    // 3. 지도 이동 + InfoWindow 열기
    map.setCenter(marker.getPosition());
    map.setZoom(15);
    naver.maps.Event.trigger(marker, 'click');
}
```

**CSS 애니메이션**:
```css
@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}
```

---

### 2. XAML - 지도 오버레이 (MainPage.xaml)

```xml
<Frame 
    HorizontalOptions="End"
    VerticalOptions="End"
    Margin="20"
    Padding="12"
    BackgroundColor="#40000000"  <!-- 75% 투명 -->
    CornerRadius="8">
    <VerticalStackLayout Spacing="6">
        <Label Text="모드: 이용자 중심" />  <!-- 한글 -->
        <Label Text="반경: 3km" />
        <BoxView HeightRequest="1" Color="#555555" />
        <Label Text="이용자: 1명" TextColor="#60A5FA" />  <!-- 실시간 -->
        <Label Text="지원사: 12명" TextColor="#FB923C" />  <!-- 실시간 -->
    </VerticalStackLayout>
</Frame>
```

---

### 3. ViewModel - 실시간 카운트 업데이트

```csharp
private void FilterAssistantsByRadius()
{
    // ...
    FilteredAssistants = new ObservableCollection<Person>(filtered);
    AssistantsInRadius = filtered.Count;  // ← 실시간 업데이트
    UsersInRadius = 1;  // 선택된 이용자
    UpdateFilterStatusText();
}

private void FilterUsersByRadius()
{
    // ...
    FilteredUsers = new ObservableCollection<Person>(filtered);
    UsersInRadius = filtered.Count;  // ← 실시간 업데이트
    AssistantsInRadius = 1;  // 선택된 지원사
    UpdateFilterStatusText();
}
```

---

## 🎯 동작 시나리오

### 시나리오 1: 이용자 클릭 (이용자 중심 모드)

```
1. 이용자 "김영희" 클릭
   ↓
2. 마커 강조:
   - 크기: 16px → 32px
   - 색상: #3B82F6 → #60A5FA (더 밝게)
   - 애니메이션: Bounce (0.6초)
   - 발광: box-shadow
   ↓
3. 지도 이동:
   - 중심: 김영희 위치
   - 줌: 15
   - InfoWindow: 자동 열림
   ↓
4. 반경 원 표시 (3km)
   ↓
5. 활동지원사 필터링 (반경 내만)
   ↓
6. 오버레이 업데이트:
   - "모드: 이용자 중심"
   - "반경: 3km"
   - "이용자: 1명"
   - "지원사: 12명" ← 실시간
```

---

### 시나리오 2: 활동지원사 클릭 (활동지원사 중심 모드)

```
1. "지원사 중심" 버튼 클릭 (토글)
   ↓
2. 활동지원사 "김지원" 클릭
   ↓
3. 마커 강조:
   - 크기: 16px → 32px
   - 색상: #F97316 → #FB923C (더 밝게)
   - 애니메이션: Bounce
   - 발광: box-shadow
   ↓
4. 지도 이동 + InfoWindow
   ↓
5. 반경 원 표시 (3km, 김지원 중심)
   ↓
6. 이용자 필터링 (반경 내만) ← 역방향!
   ↓
7. 오버레이 업데이트:
   - "모드: 활동지원사 중심"
   - "반경: 3km"
   - "이용자: 3명" ← 실시간
   - "지원사: 1명"
```

---

### 시나리오 3: 다른 지원사 클릭 (마커 복원)

```
1. 지원사 "박민수" 클릭
   ↓
2. 이전 마커 "김지원" 복원:
   - 크기: 32px → 16px
   - 색상: #FB923C → #F97316
   - 애니메이션 없음
   ↓
3. 새 마커 "박민수" 강조:
   - 크기: 32px
   - 색상: #FB923C
   - Bounce 애니메이션
   ↓
4. 지도 이동 + 반경 원 업데이트
   ↓
5. 이용자 필터링 재계산
   ↓
6. 오버레이 업데이트 (실시간)
```

---

## ✅ 변경 사항 요약

### 파일 수정 (7개)

| 파일 | 변경 내용 |
|------|-----------|
| `map.html` | highlightedMarker 추적, focusMarker 강화, bounce 애니메이션 |
| `MapViewModel.cs` | UsersInRadius/AssistantsInRadius 초기화, 실시간 업데이트 |
| `MainPage.xaml` | 오버레이 투명도 #40000000, CenterModeToKoreanConverter |
| `App.xaml` | CenterModeToKoreanConverter 등록 |
| `CenterModeToKoreanConverter.cs` | 신규 파일 (User → "이용자 중심") |

---

## 🚀 앱 재시작

```bash
# 앱 종료 (Ctrl+C 또는 창 닫기)
cd C:\ai\projects\map-demo\src\LmpLink.MAUI
dotnet run
```

---

## 🎨 시각적 효과

### Before (기존)
- 마커 크기: 16px (고정)
- 색상: 어두운 파란/주황
- 애니메이션: 없음
- 오버레이: 불투명 (#CC = 80%)

### After (개선)
- 마커 크기: 16px → **32px** (클릭 시)
- 색상: **밝은** 파란/주황 + **발광 효과**
- 애니메이션: **Bounce** (0.6초, -10px 위로)
- 오버레이: **매우 투명** (#40 = 25%)

---

## 📋 테스트 체크리스트

- [ ] 이용자 클릭 → 마커 크기 2배 + Bounce
- [ ] 지원사 클릭 → 마커 크기 2배 + Bounce
- [ ] 다른 마커 클릭 → 이전 마커 복원
- [ ] 오버레이: 투명하게 표시
- [ ] 오버레이: 모드 한글로 표시
- [ ] 오버레이: 인원 수 실시간 업데이트

---

**작성일**: 2025-12-10  
**작성자**: AI Assistant  
**문서 버전**: 1.0

